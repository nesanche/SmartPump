angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","ngMessages","ngResource","angular-loading-bar","ngAnimate","angular-md5","ui.bootstrap.datetimepicker","ui.grid"]);
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"templates/home.html",controller:"HomeController"}).state("datos",{url:"/datos",templateUrl:"templates/datosPersonales.html",controller:"ProfileController"}).state("pacientes",{url:"/pacientes",templateUrl:"templates/viewPacientes.html",controller:"DoctorController"}).state("loginDoctor",{url:"/loginDoctor",templateUrl:"templates/login.html",controller:"LoginDoctorController"}).state("loginPaciente",{url:"/loginPaciente",templateUrl:"templates/login.html",controller:"LoginPatientController"}).state("nuevoTratamiento",{url:"/nuevoTratamiento",templateUrl:"templates/schedule.html",controller:"TratamientoController"}).state("historial",{url:"/historial",templateUrl:"templates/historial.html",controller:"HistorialController"})}]).run(["$rootScope","$location","$cookieStore","$http",function(t,e,o,l){t.globals=o.get("globals")||{},t.globals.currentUser&&(l.defaults.headers.common.Authorization="Basic "+t.globals.currentUser.authdata),t.$on("$locationChangeStart",function(o,l,r){"/home"===e.path()||t.globals.currentUser||e.path("/home")})}]);
function AlertsCtrl(e){e.alerts=[{type:"success",msg:"Thanks for visiting! Feel free to create pull requests to improve the dashboard!"},{type:"danger",msg:"Found a bug? Create an issue with as many details as you can."}],e.addAlert=function(){e.alerts.push({msg:"Another alert!"})},e.closeAlert=function(t){e.alerts.splice(t,1)}}angular.module("RDash").controller("AlertsCtrl",["$scope",AlertsCtrl]);
function DoctorController(o,t,e,r,n){e.viewBackground="background-white",e.menu="ng-show",o.doctor=e.doctor,t.allPacientes(o.doctor.id).then(function(t){for(var e=0;e<t.length;e++)t[e].birthDate=n("date")(new Date(t[e].birthDate),"dd-MM-yyyy");o.items=t}),o.addSchedule=function(o){e.patient=o,e.idPump=o.treatment.pump.id,r.location.href="#/nuevoTratamiento"}}angular.module("RDash").controller("DoctorController",["$scope","DoctorService","$rootScope","$window","$filter",DoctorController]);
function HistorialController(e,t,a,n,o){n.viewBackground="background-white",n.menu="ng-show",e.doctor=n.doctor,e.caret=!0,e.title=!1,t.allPacientes(e.doctor.id).then(function(t){e.patients=t}),void 0!=n.patient?e.patient.name=n.patient.firstName+" "+n.patient.lastName:(e.patient={name:"Seleccione "},e.idPump=null),e.changePatient=function(t){e.patient.name=t.firstName+" "+t.lastName,e.caret=!1,a.getAll(t.id).then(function(t){for(var a=0;a<t.length;a++)t[a].startDate=o("date")(new Date(t[a].startDate),"dd-MM-yyyy");e.items=t})},e.getDoses=function(t){a.getDoses(t).then(function(t){for(var a=0;a<t.length;a++)switch(t[a].time=o("date")(new Date(t[a].time),"HH:mm"),t[a].day){case 1:t[a].day="Lunes";break;case 2:t[a].day="Martes";break;case 3:t[a].day="Miércoles";break;case 4:t[a].day="Jueves";break;case 5:t[a].day="Viernes";break;case 6:t[a].day="Sábado";break;case 7:t[a].day="Domingo"}e.doses=t,e.title=!0})},e.openSchedule=function(){e.doses=""}}angular.module("RDash").controller("HistorialController",["$scope","DoctorService","TratamientoService","$rootScope","$filter",HistorialController]);
function HomeController(o,e){e.menu="ng-hide",o.doctor={},o.user={},e.doctor={},o.paciente={}}angular.module("RDash").controller("HomeController",["$scope","$rootScope",HomeController]);
function ItemController(e,o){o.menu="ng-show",alert("hola item controller"),scope.$parent.isopen=scope.$parent["default"]===scope.item,scope.$watch("isopen",function(e,o,t){t.$parent.isopen=e})}angular.module("RDash").controller("ItemController",["$scope","$rootScope",ItemController]);
function LoginDoctorController(e,r,o){r.menu="ng-hide",$("#login-form-link").click(function(r){e.user="",e.doctor="",$("#login-form").delay(100).fadeIn(100),$("#register-form").fadeOut(100),$("#social-buttons").fadeIn(100),$("#register-form-link").removeClass("active"),$(this).addClass("active"),r.preventDefault()}),$("#register-form-link").click(function(r){e.doctor="",e.user="",$("#register-form").delay(100).fadeIn(100),$("#login-form").fadeOut(100),$("#login-form-link").removeClass("active"),$("#social-buttons").fadeOut(100),$(this).addClass("active"),r.preventDefault()}),o.ClearCredentials(),e.login=function(r){e.user=r,o.login(r)},e.newUser=function(r,t){if(r.password!=r.confirmPassword)return sweetAlert("Oops...","Debe confirmar correctamente la contraseña!","error"),!1;var n={username:r.username,password:r.password,state:{id:1,description:"Pending"}},t={user:n,firstName:t.firstName,lastName:t.lastName,registrationNumber:t.registrationNumber,phone:t.phone,address:t.address,email:t.email,role:{id:2,description:"Doctor"}};e.doctor=t,o.newDoctor(e.doctor)}}angular.module("RDash").controller("LoginDoctorController",["$scope","$rootScope","AuthService",LoginDoctorController]);
function loginPatientController(o,n){n.menu="ng-hide",$("#register-form-link").remove(),$("#inicioSesion").css("width","100%"),$("#login-form-link").click(function(n){o.user="",o.doctor="",n.preventDefault()}),o.login=function(n){o.user=n,AuthService.login(n)}}angular.module("RDash").controller("loginPatientController",["$scope","$rootScope",loginPatientController]);
function MasterCtrl(e,i,t,o,n){function a(){n.getAll().then(function(i){if(""!=i){e.notifications=i;for(var t=0;t<i.length;t++)switch(i[t].notificationType.id){case 1:i[t].notificationType.description="/historial";break;case 2:i[t].notificationType.description="/datos";break;case 3:i[t].notificationType.description="/pacientes";break;default:i[t].notificationType.description="/datos"}}})}o.SetCredentials("emajul","d9b5e7bfd2f4a68ed62dfae899a3a164"),i.doctor={id:10,firstName:"Enrique",lastName:"Majul",phone:"4555160",email:"lucas_borsatto@hotmail.com",registrationNumber:"1546589",address:"colon 1200",user:{id:14,username:"emajul",password:"d9b5e7bfd2f4a68ed62dfae899a3a164",state:{id:2,description:"Registered"},role:{id:2,description:"Doctor"}}},i.menu="ng-hide",i.viewBackground="background-img",a();var r=992;e.getWidth=function(){return window.innerWidth},e.$watch(e.getWidth,function(i,o){e.toggle=i>=r?angular.isDefined(t.get("toggle"))?t.get("toggle")?!0:!1:!0:!1}),e.toggleSidebar=function(){e.toggle=!e.toggle,t.put("toggle",e.toggle)},window.onresize=function(){e.$apply()},e.openNotification=function(e,t){-1!=t&&n.setView(t).then(function(e){a()}),"open"==e?i.notificationOpen="":(i.notificationOpen="open",i.profile="")},e.openProfile=function(e){"open"==e?i.profile="":(i.profile="open",i.notificationOpen="")}}angular.module("RDash").controller("MasterCtrl",["$scope","$rootScope","$cookieStore","AuthService","NotificationService",MasterCtrl]);
function ProfileController(o,r,e){e.viewBackground="background-white",e.menu="ng-show",o.doctor=e.doctor}angular.module("RDash").controller("ProfileController",["$scope","DoctorService","$rootScope",ProfileController]);
function TratamientoController(e,t,a,n,i){i.allPacientes(e.doctor.id).then(function(t){e.patients=t}),n.viewBackground="background-white",n.menu="ng-show",e.today=function(){e.startDate=new Date},e.startDate=a("date")(new Date,"yyyy-MM-dd"),e.clear=function(){e.startDate=null},e.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:new Date},e.toggleMin(),e.open=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.formats=["yyyy-MM-dd","yyyy/MM/dd","dd-MM-yyyy","shortDate"],e.format=e.formats[0];var s=new Date;s.setDate(s.getDate()+1);var d=new Date;d.setDate(s.getDate()+2),e.events=[{date:s,status:"full"},{date:d,status:"partially"}],e.getDayClass=function(t,a){if("day"===a)for(var n=new Date(t).setHours(0,0,0,0),i=0;i<e.events.length;i++){var s=new Date(e.events[i].date).setHours(0,0,0,0);if(n===s)return e.events[i].status}return""},e.days=[{id:1,name:"Lunes",state:!1},{id:2,name:"Martes",state:!1},{id:3,name:"Miércoles",state:!1},{id:4,name:"Jueves",state:!1},{id:5,name:"Viernes",state:!1},{id:6,name:"Sábado",state:!1},{id:7,name:"Domingo",state:!1}],e.marcarTodos=function(t){e.days=1==t?[{id:1,name:"Lunes",state:!0},{id:2,name:"Martes",state:!0},{id:3,name:"Miércoles",state:!0},{id:4,name:"Jueves",state:!0},{id:5,name:"Viernes",state:!0},{id:6,name:"Sábado",state:!0},{id:7,name:"Domingo",state:!0}]:[{id:1,name:"Lunes",state:!1},{id:2,name:"Martes",state:!1},{id:3,name:"Miércoles",state:!1},{id:4,name:"Jueves",state:!1},{id:5,name:"Viernes",state:!1},{id:6,name:"Sábado",state:!1},{id:7,name:"Domingo",state:!1}]},e.timeDisplay=!0,e.types=[{name:"Seleccione",id:null},{name:"Basal",id:1},{name:"Bolus",id:2}],e.caret=!0,void 0!=n.patient?(e.patient.name=n.patient.firstName+" "+n.patient.lastName,e.idPump=n.idPump):(e.patient={name:"Seleccione "},e.idPump=null),e.changePatient=function(t){e.patient.name=t.firstName+" "+t.lastName,e.idPump=t.treatment.pump.id,e.caret=!1},e.typeInsulin={name:"Seleccione",id:null},e.changeType=function(t){e.typeInsulin=t,2==t.id?(e.timeDisplay=!1,e.cantidad=1,e.cantDisabled=!0):(e.timeDisplay=!0,e.cantDisabled=!1)},e.timeDesde=new Date,e.timeHasta=new Date,e.showMeridian=!1,e.status={isopen:!1},e.status2={isopen:!1},e.toggleDropdown=function(t){t.preventDefault(),t.stopPropagation(),e.status.isopen=!e.status.isopen},e.tabs=[{title:"Basal",content:"Dynamic content 1"},{title:"Bolo",content:"Dynamic content 2"},{title:"Todos",content:"Dynamic content 3"}];var o='<button type="button" class="btn btn-delete" ng-click="grid.appScope.deleteRow(row)"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span></button>';e.myData=[];var l=[{name:"Día",field:"day"},{name:"Tipo",field:"typeInsulin"},{name:"Unidad",field:"unidad"},{name:"Cantidad",field:"cantidad"},{name:"Desde",field:"timeDesde"},{name:"Hasta",field:"timeHasta"},{name:"Opción",cellTemplate:o}];e.gridOptions={columnDefs:l,data:"myData"},e.deleteRow=function(t){swal({title:"¿Está seguro?",text:"¡Eliminará una programación del día "+t.entity.day+"!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",closeOnConfirm:!1,closeOnCancel:!1},function(a){if(a){var n=e.myData.indexOf(t.entity);e.$apply(function(){e.myData.splice(n,1)}),swal("¡Eliminada!","Se eliminó la programación del día "+t.entity.day,"success")}else swal.close()})},e.addDosis=function(){if(1==e.typeInsulin.id&&e.timeHasta<=e.timeDesde)swal("¡Imposible cargar!","El tiempo 'Hasta' debe ser mayor al 'Desde'","warning");else{var t=0;if(2==e.typeInsulin.id)e.timeHasta=e.timeDesde;else{var n=e.timeHasta-e.timeDesde,i=Math.round(n%864e5/36e5),s=Math.round(n%864e5%36e5/6e4),d=60*i+s;t=d/e.cantidad}for(var o=0;o<e.days.length;o++)if(1==e.days[o].state){{e.myData.length+1}e.myData.push({day:e.days[o].name,dayId:e.days[o].id,typeInsulin:e.typeInsulin.name,typeInsulinId:e.typeInsulin.id,unidad:e.dosis.unidad,cantidad:e.cantidad,timeDesde1:a("date")(e.timeDesde,"yyyy-MM-dd HH:mm:00"),timeHasta1:a("date")(e.timeHasta,"yyyy-MM-dd HH:mm:00"),timeDesde:a("date")(e.timeDesde,"HH:mm:00"),timeHasta:a("date")(e.timeHasta,"HH:mm:00"),rango:t})}}},e.newTreatment=function(n){function i(e,t,a,n,i){var d={units:e,time:t,day:a,doseType:{id:n,description:i}};s.doses.push(d)}var n={startDate:e.startDate,endDate:null,profile:n.perfil,confirmed:!1},n=angular.toJson(n),s={doses:[]};console.log(e.myData),angular.forEach(e.myData,function(e,t){if(1==e.typeInsulinId)for(var n=0;n<e.cantidad;n++)if(n>0){var s=new Date(e.timeDesde1);s.setMinutes(s.getMinutes()+e.rango*n),s=a("date")(s,"HH:mm:00"),i(e.unidad,s,e.dayId,e.typeInsulinId,e.typeInsulin)}else i(e.unidad,e.timeDesde,e.dayId,e.typeInsulinId,e.typeInsulin);else i(e.unidad,e.timeDesde,e.dayId,e.typeInsulinId,e.typeInsulin)});var s=angular.toJson(s);console.log("doses "+s),t.newSchedule(n,e.idPump).then(function(e){var a=e.id;t.newDoses(s,a)})}}angular.module("RDash").controller("TratamientoController",["$scope","TratamientoService","$filter","$rootScope","DoctorService",TratamientoController]);
function compareTo(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,o,r,a){a.$validators.compareTo=function(o){return o==e.otherModelValue},e.$watch("otherModelValue",function(){a.$validate()})}}}angular.module("RDash").directive("compareTo",compareTo);
function emailValidator(e,a){return{require:"ngModel",link:function(r,t,i,n){n.$asyncValidators.email=function(r,t){if(!t)return a.when(!0);var i=a.defer();return e.get(pathRemote+"rest/doctors/verifyEmail?email="+t).then(function(e){"false"==e.data&&i.reject(),i.resolve()}),i.promise}}}}angular.module("RDash").directive("emailValidator",["$http","$q",emailValidator]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function matriculaValidator(r,e){return{require:"ngModel",link:function(t,a,i,n){n.$asyncValidators.matricula=function(t,a){if(!a)return e.when(!0);var i=e.defer();return r.get(pathRemote+"rest/doctors/getByRegNumber",{headers:{registrationNumber:a}}).then(function(r){i.reject()},function(r){i.resolve()}),i.promise}}}}angular.module("RDash").directive("matriculaValidator",["$http","$q",matriculaValidator]);
function passwordValidator(r){return{require:"ngModel",link:function(a,e,o,n){n.$asyncValidators.password=function(a,e){if(!e)return r.when(!0);var o=r.defer(),n=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,20}$/;return e.match(n)||o.reject(),o.resolve(),o.promise}}}}angular.module("RDash").directive("passwordValidator",["$q",passwordValidator]);
function usernameValidator(e,r){return{require:"ngModel",link:function(a,n,t,u){u.$asyncValidators.username=function(a,n){if(!n)return r.when(!0);var t=r.defer();return e.get(pathRemote+"rest/users/verifyUsername?username="+n).then(function(e){"false"==e.data&&t.reject(),t.resolve()}),t.promise}}}}angular.module("RDash").directive("usernameValidator",["$http","$q",usernameValidator]);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"@?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);
function AuthService(e,r,o,t,s,a,n){var c={};return c.login=function(a){e.start();var n=r.createHash(a.password||"");o.get(pathRemote+"rest/doctors/getDoctor",{headers:{username:a.username,password:n}}).success(function(r,o,a,i){e.complete(),null==r?sweetAlert("Oops...","¡No existe el Médico con los datos ingresados!","error"):1==r.user.state.id?sweetAlert("Pendiente de Autorización","¡Todavía no está autorizado para usar Bismara!","warning"):(sweetAlert("Bienvenido a Bismara ",r.user.username),c.SetCredentials(r.user.username,n),s.doctor=r,t.location.href="#/datos")}).error(function(r,o,t,s){e.complete(),"401"==o?sweetAlert("Oops...","Usuario y/o contraseña incorrecta.","error"):sweetAlert("Oops...","Imposible conectar con el servidor.","error")})},c.ClearCredentials=function(){s.globals={},n.remove("globals"),o.defaults.headers.common.Authorization="Basic "},c.SetCredentials=function(e,r){var t=a.encode(e+":"+r);s.globals={currentUser:{username:e,authdata:t}},o.defaults.headers.common.Authorization="Basic "+t,n.put("globals",s.globals)},c.newDoctor=function(t){t.user.password=r.createHash(t.user.password||""),o.post(pathRemote+"rest/doctors/new",t).success(function(r,o,t,s){e.complete(),sweetAlert("¡Bienvenido!","Gracias por registrarse en Bismara "+r.user.username,"success")}).error(function(r,o,t,s){e.complete(),sweetAlert("Oops...","Imposible conectar con el servidor.","error")})},c}var pathLocal="http://localhost:81/Bismara/",pathRemote="http://bismara.elasticbeanstalk.com/";angular.module("RDash").factory("AuthService",["cfpLoadingBar","md5","$http","$window","$rootScope","Base64","$cookieStore",AuthService]);
function Base64(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(r){var a,t,n,c,h,d="",i="",o="",A=0;do a=r.charCodeAt(A++),t=r.charCodeAt(A++),i=r.charCodeAt(A++),n=a>>2,c=(3&a)<<4|t>>4,h=(15&t)<<2|i>>6,o=63&i,isNaN(t)?h=o=64:isNaN(i)&&(o=64),d=d+e.charAt(n)+e.charAt(c)+e.charAt(h)+e.charAt(o),a=t=i="",n=c=h=o="";while(A<r.length);return d},decode:function(r){var a,t,n,c,h,d="",i="",o="",A=0,f=/[^A-Za-z0-9\+\/\=]/g;f.exec(r)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=e.indexOf(r.charAt(A++)),c=e.indexOf(r.charAt(A++)),h=e.indexOf(r.charAt(A++)),o=e.indexOf(r.charAt(A++)),a=n<<2|c>>4,t=(15&c)<<4|h>>2,i=(3&h)<<6|o,d+=String.fromCharCode(a),64!=h&&(d+=String.fromCharCode(t)),64!=o&&(d+=String.fromCharCode(i)),a=t=i="",n=c=h=o="";while(A<r.length);return d}}}angular.module("RDash").factory("Base64",Base64);
function DoctorService(t,e){var r={};return r.allPacientes=function(r){var o=e.defer();return t.get(pathRemote+"rest/doctors/patients",{headers:{"doctor-id":10}}).success(function(t){o.resolve(t)}).error(function(t){o.reject(t)}),o.promise},r}var pathLocal="http://localhost:81/Bismara/",pathRemote="http://bismara.elasticbeanstalk.com/";angular.module("RDash").factory("DoctorService",["$http","$q",DoctorService]);
function NotificationService(e,t){var r={};return r.getAll=function(){var r=t.defer();return e.get(pathRemote+"rest/users/getNotifications").success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},r.setView=function(r){var i=t.defer();return e.get(pathRemote+"rest/users/confirmNotification",{headers:{"notification-id":r}}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},r}var pathLocal="http://localhost:81/Bismara/",pathRemote="http://bismara.elasticbeanstalk.com/";angular.module("RDash").factory("NotificationService",["$http","$q",NotificationService]);
function TratamientoService(e,t,r,o){var s={},c=t.defer();return s.newSchedule=function(t,o,s){return e.post(pathRemote+"rest/schedules/new",t,{headers:{"id-pump":o}}).success(function(e,t,o,s){c.resolve(e),r.complete()}).error(function(e,t,o,s){c.reject(e),r.complete(),sweetAlert("Oops...","Imposible conectar con el servidor.","error")}),c.promise},s.newDoses=function(t,s){e.post(pathRemote+"rest/schedules/doses",t,{headers:{"id-schedule":s}}).success(function(e,t,s,c){r.complete(),swal({title:"Tratamiento guardado.",text:"¡Se registró con éxito el tratamiento!",type:"success"},function(){o.location.reload()})}).error(function(e,t,o,s){r.complete(),console.log(e),sweetAlert("Oops...","Imposible conectar con el servidor.","error")})},s.getAll=function(r){var o=t.defer();return e.get(pathRemote+"rest/schedules/getAll",{headers:{"id-patient":r}}).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},s.getDoses=function(r){var o=t.defer();return e.get(pathRemote+"rest/schedules/getDoses",{headers:{"id-schedule":r}}).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},s}var pathLocal="http://localhost:81/Bismara/",pathRemote="http://bismara.elasticbeanstalk.com/";angular.module("RDash").factory("TratamientoService",["$http","$q","cfpLoadingBar","$window",TratamientoService]);